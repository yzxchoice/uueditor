var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{h(n.next(t))}catch(e){o(e)}}function a(t){try{h(n["throw"](t))}catch(e){o(e)}}function h(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,a)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,o&&(s=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,o=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],o=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,o,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},ImagesLoader=function(){function t(t){this.imageCount=0,this.images=[],this.completeCallback=t}return t.prototype.load=function(t){var e;for(this.imageCount=t.length,e=0;e<this.imageCount;e++)this.loadImage(t[e])},t.prototype.loadImage=function(t){var e=new egret.ImageLoader;this.images.push(e),e.addEventListener(egret.Event.COMPLETE,this.checkComplete,this),e.load(t)},t.prototype.checkComplete=function(){if(--this.imageCount<=0&&null!=this.completeCallback){var t=this.completeCallback;this.completeCallback=null,t()}},t}();__reflect(ImagesLoader.prototype,"ImagesLoader");var ActionBox=function(t){function e(){var e=t.call(this)||this;return e.imgList=[{id:"10003",name:"timg.jpg"}],e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.dispose=function(){},e.prototype.draw=function(t){this.container=t,this.container.addChild(this)},e.getInstance=function(t){return this.instance||(this.instance=new ImageBox),this.instance},e.prototype.onAddToStage=function(t){this.init()},e.prototype.init=function(){this.horizontalCenter=0,this.verticalCenter=0,this.width=1200,this.height=800;for(var t=0;t<this.imgList.length;t++){var e=new UUImage;e.source="resource/assets/"+this.imgList[t].name,e.y=50,e.x=120*t,e.width=100,e.height=100,e.name=this.imgList[t].id,e.data=this.imgList[t],e.addEventListener(Mouse.START,this.addImage,this),this.addChild(e)}},e.prototype.addImage=function(t){this.container.editGroup.addComponent(t.currentTarget.data)},e.prototype.open=function(t){t.addChild(this)},e}(eui.Panel);__reflect(ActionBox.prototype,"ActionBox",["IUUContainer"]);var BgBox=function(t){function e(){var e=t.call(this)||this;return e.imgList=[{id:"9003",name:"bg.jpg"},{id:"9004",name:"bg1.jpg"}],e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.getInstance=function(t){return this.instance||(this.instance=new ImageBox),this.instance},e.prototype.onAddToStage=function(t){this.init()},e.prototype.init=function(){this.horizontalCenter=0,this.verticalCenter=0,this.width=1200,this.height=800;for(var t=0;t<this.imgList.length;t++){var e=new eui.Image;e.source="resource/assets/"+this.imgList[t].name,e.y=50,e.x=120*t,e.width=100,e.height=100,e.name=this.imgList[t].id,e.addEventListener(Mouse.START,this.addImage,this),this.addChild(e)}},e.prototype.addImage=function(t){var e=this.parent;e.editGroup.changeBg(t.currentTarget.source)},e.prototype.open=function(t){t.addChild(this)},e}(eui.Panel);__reflect(BgBox.prototype,"BgBox");var CheckItem=function(t){function e(e){var i=t.call(this)||this;return i.labelText=e,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),Object.defineProperty(e.prototype,"isOver",{get:function(){return this._isOver},set:function(t){this._isOver=t,this.shape.visible=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSelected",{get:function(){return this._isSelected},set:function(t){this._isSelected=t,this.checkBox.selected=t},enumerable:!0,configurable:!0}),e.prototype.onAddToStage=function(){this.width=this.parent.width,this.height=30,this.shape=new egret.Shape,this.shape.graphics.beginFill(1673959),this.shape.graphics.drawRect(0,0,this.width,this.height),this.shape.graphics.endFill(),this.isOver=!1,this.addChild(this.shape),this.checkBox=new eui.CheckBox,this.checkBox.label=this.labelText,this.checkBox.width=this.width,this.checkBox.height=this.height,this.addChild(this.checkBox)},e}(eui.Group);__reflect(CheckItem.prototype,"CheckItem");var ComponentBox=function(t){function e(){var e=t.call(this)||this;return e.imgList=[{id:"10003",name:"circle.png"}],e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.getInstance=function(t){return this.instance||(this.instance=new ImageBox),this.instance},e.prototype.onAddToStage=function(t){this.init()},e.prototype.init=function(){this.horizontalCenter=0,this.verticalCenter=0,this.width=1200,this.height=800;for(var t=0;t<this.imgList.length;t++){var e=new UUImage;e.source="resource/assets/"+this.imgList[t].name,e.y=50,e.x=120*t,e.width=100,e.height=100,e.name=this.imgList[t].id,e.data=this.imgList[t],e.addEventListener(Mouse.START,this.addImage,this),this.addChild(e)}},e.prototype.addImage=function(t){var e=this.parent;e.editGroup.addComponent(t.currentTarget.data)},e.prototype.open=function(t){t.addChild(this)},e}(eui.Panel);__reflect(ComponentBox.prototype,"ComponentBox");var EditGroup=function(t){function e(){var e=t.call(this)||this;return e.displayList=[],e.pages=[],e.pageIndex=0,e.borderColor=13421772,e.bg=new eui.Component,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.onAddToStage=function(t){this.tool=new TransformTool(this),this.bindHandlers(),this.getPages(),this.init()},e.prototype.bindHandlers=function(){this.render=this.render.bind(this)},e.prototype.getPages=function(){this.pages=RES.getRes("data_json").list},e.prototype.init=function(){this.addBg(),this.renderResources(this.pageIndex),this.setupTool(),this.stage.addEventListener(Mouse.START,this.down,this),this.render()},e.prototype.addBg=function(){this.bg.width=this.width,this.bg.height=this.height,this.addChild(this.bg)},e.prototype.setupTool=function(){ControlSet.controlClass=EgretControl,this.tool.setControls(ControlSet.getUniformScaler())},e.prototype.getCustomControls=function(){var t=new EgretControl(ControlType.TRANSLATE);t.hitTestTarget=!0;var e=new EgretControl(ControlType.TARGET);return[new EgretControl(ControlType.ROTATE,0,0,0,0,40),new EgretControl(ControlType.ROTATE,0,1,0,0,40),new EgretControl(ControlType.ROTATE,1,0,0,0,40),new EgretControl(ControlType.ROTATE,1,1,0,0,40),e,t,new EgretControl(ControlType.BORDER),new EgretControl(ControlType.REGISTRATION,.5,.5,0,0,20),new EgretControl(ControlType.SKEW_Y,0,.5,0,0,10),new EgretControl(ControlType.SCALE_X,1,.5,0,0,10),new EgretControl(ControlType.SKEW_X,.5,0,0,0,10),new EgretControl(ControlType.SCALE_Y,.5,1,0,0,10),new EgretControl(ControlType.SCALE,0,0,0,0,10),new EgretControl(ControlType.SCALE,0,1,0,0,10),new EgretControl(ControlType.SCALE,1,0,0,0,10),new EgretControl(ControlType.SCALE,1,1,0,0,10),new EgretControl(ControlType.ROTATE_SCALE,1,0,15,-15,10),new EgretControl(ControlType.SCALE_UNIFORM,1,1,15,15,10),new EgretControl(ControlType.ROTATE,.5,0,0,-20)]},e.prototype.down=function(t){Mouse.get(t,this);var e=this.tool.start(Mouse.x,Mouse.y);return this.containsPoint(Mouse.x,Mouse.y)?(!e&&this.selectImage(Mouse.x,Mouse.y)&&(e=this.tool.start(Mouse.x,Mouse.y,this.findControlByType(ControlType.TRANSLATE))),e&&(this.stage.addEventListener(Mouse.MOVE,this.move,this),this.stage.addEventListener(Mouse.END,this.up,this)),requestAnimationFrame(this.render),void t.preventDefault()):!1},e.prototype.move=function(t){Mouse.get(t,this),this.applyDynamicControls(t),this.tool.move(Mouse.x,Mouse.y),requestAnimationFrame(this.render),t.preventDefault()},e.prototype.up=function(t){this.tool.end();for(var e=this.pages[this.pageIndex].elements,i=0;i<e.length;i++)e[i].id===this.tool.target.owner.image.data.id&&(e[i].matrix=this.tool.target.matrix);this.stage.removeEventListener(Mouse.MOVE,this.move,this),this.stage.removeEventListener(Mouse.END,this.up,this),requestAnimationFrame(this.render),t.preventDefault()},e.prototype.deliveryItemMessageToControlPanel=function(t){console.log("targetItem..."),console.log(t);var e=t.matrix,i=t.owner.image,n=(e.a,e.b,e.c,e.d,e.x,e.y,t.width),r=t.height,o=i.scaleX,s=i.scaleY,a=i.rotation,h=this.parent.parent,d=h.siderbarSkinBy,l={x:Math.floor(this.tool.regX),y:Math.floor(this.tool.regY),width:Math.floor(n*o),height:Math.floor(r*s),rotate:Math.floor(a)};d.data=l;var p=t.owner.image.data.id,c=this.pages[this.pageIndex].properties.triggerGroup;console.log("-----------------"),console.log(c),d.targetItemId=p,d.triggerGroup=c},e.prototype.setProperty=function(t,e){var i=this.pages[this.pageIndex].elements,n=this.tool.target.matrix;n.translate(t,e);for(var r=0;r<i.length;r++)i[r].id===this.tool.target.owner.image.name&&(i[r].matrix=n)},e.prototype.applyDynamicControls=function(t){var e=this.getDynamicControl();console.log("dyn:"+e),e&&(t.ctrlKey?t.shiftKey?e.type=ControlType.ROTATE_SCALE:e.type=ControlType.ROTATE:t.shiftKey?e.type=ControlType.SCALE:e.type=ControlType.TRANSLATE)},e.prototype.getDynamicControl=function(){var t=0,e=this.tool.controls.length;for(t=0;e>t;t++)if(this.tool.controls[t].dynamicUV)return this.tool.controls[t];return null},e.prototype.findControlByType=function(t){var e=0,i=this.tool.controls.length;for(e=0;i>e;e++)if(this.tool.controls[e].type==t)return this.tool.controls[e];return null},e.prototype.containsPoint=function(t,e){var i=this.parent.localToGlobal(this.matrix.tx,this.matrix.ty),n=this.localToGlobal(Mouse.x,Mouse.y),r=new Matrix(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,i.x,i.y);return r.containsPoint(n.x,n.y,this.width,this.height)},e.prototype.selectImage=function(t,e){for(var i=null,n=null,r=this.displayList.length;r--;)if(i=this.displayList[r],n=i.transform,n.matrix.containsPoint(t,e,n.width,n.height))return this.tool.target!==n?(this.tool.setTarget(n),this.displayList.splice(r,1),this.displayList.push(i),!0):!1;var o=new egret.Point(t,e),s=new egret.Rectangle(0,0,this.width,this.height);return s.containsPoint(o)?(this.tool.setTarget(null),!1):void 0},e.prototype.renderResources=function(t){var e=0,i=this.pages[t].elements,n=i.length;for(e=0;n>e;e++)switch(i[e].type){case 1:var r=new UULabel;r.text=i[e].content,r.textColor=16711680,r.size=16,r.lineSpacing=12,r.textAlign=egret.HorizontalAlign.JUSTIFY,r.name=i[e].id,r.data=i[e],this.displayList.push(new Picture(r,i[e].matrix));break;case 2:var o=new UUBitmap,s=RES.getRes(i[e].name);o.texture=s,o.name=i[e].id,o.data=i[e],this.displayList.push(new Picture(o,i[e].matrix));break;case 18:var a=new SoundButton;a.label=i[e].name,a.name=i[e].id,a.data=i[e],a.width=100,a.height=50,this.displayList.push(new Picture(a,i[e].matrix));break;case 101:var h=new CircleSector;h.name=i[e].id,h.data=i[e],h.width=400,h.height=400,this.displayList.push(new Picture(h,i[e].matrix));break;case 8:}},e.prototype.render=function(){this.clear(),this.drawDisplayList(),this.tool.draw()},e.prototype.clear=function(){this.tool.undraw()},e.prototype.reset=function(){this.clear();var t=0,e=this.displayList.length;for(t=0;e>t;t++)this.displayList[t].undraw(this);this.displayList=[]},e.prototype.drawDisplayList=function(){var t=0,e=this.displayList.length;for(t=0;e>t;t++)this.displayList[t].draw(this)},e.prototype.pre=function(t){this.pageIndex>0&&(this.reset(),this.pageIndex--,this.renderResources(this.pageIndex))},e.prototype.next=function(t){this.pageIndex<this.pages.length-1&&(this.reset(),this.pageIndex++,this.renderResources(this.pageIndex))},e.prototype.addSinglePicture=function(t){RES.getResByUrl("resource/assets/"+t.url,function(e){var i=new Matrix(1,0,0,1,300,500),n=new UUBitmap;n.texture=e;var r=this.pages[this.pageIndex].elements;t.id=t.id+"-"+this.displayList.length,r.push({id:t.id,name:t.name,pageId:201807311008,type:2,matrix:{a:i.a,b:i.b,c:i.c,d:i.d,x:i.x,y:i.y},src:"resource/assets/"+t.url,sceneId:1001}),n.name=t.id,n.data=t,this.displayList.push(new Picture(n,i))},this,RES.ResourceItem.TYPE_IMAGE)},e.prototype.changeBg=function(t){RES.getResByUrl(t,function(t){var e=new egret.Bitmap;e.texture=t,e.width=this.bg.width,e.height=this.bg.height,this.bg.removeChildren(),this.bg.addChild(e)},this,RES.ResourceItem.TYPE_IMAGE)},e.prototype.addSound=function(t){var e=new Matrix(1,0,0,1,300,500),i=t.name,n=this.pages[this.pageIndex].elements,r=this.pages[this.pageIndex].properties.triggerGroup;t.id=t.id+"-"+this.displayList.length,n.push({id:t.id,name:i,pageId:201807311008,type:18,matrix:{a:e.a,b:e.b,c:e.c,d:e.d,x:e.x,y:e.y},sound:{id:t.id,name:i,src:"resource/assets/"+t.url},sceneId:1001}),r.push({delay:0,eventType:1,sourceId:t.id,sourceType:"e",targetId:t.id,targetState:4,targetType:"e"});var o=new SoundButton;o.label=t.name,o.name=t.id,o.width=100,o.height=50,o.data=t,this.displayList.push(new Picture(o,e))},e.prototype.addComponent=function(t){var e=new Matrix(1,0,0,1,0,0),i=t.name,n=this.pages[this.pageIndex].elements;t.id=t.id+"-"+this.displayList.length,n.push({id:t.id,name:i,pageId:201807311008,type:101,matrix:{a:e.a,b:e.b,c:e.c,d:e.d,x:e.x,y:e.y},sceneId:1001});var r=new CircleSector;r.data=t,r.width=400,r.height=400,this.displayList.push(new Picture(r,e))},e}(eui.Group);__reflect(EditGroup.prototype,"EditGroup");var EventSetDome=function(t){function e(e){void 0===e&&(e="");var i=t.call(this)||this;return i.siderbarSkin=SiderbarSkinBy.getInstance(),i.triggerGroup=i.siderbarSkin.triggerGroup,i._isShow=!0,i.skinName="resource/skins/EventSet.exml",i.label_title.text=e,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStageInit,i),i}return __extends(e,t),e.prototype.dispose=function(){for(var t=this.data,e=null,i=0,n=this.triggerGroup.length;n>i;i++){var r=this.triggerGroup[i];if(t.sourceId==r.sourceId&&t.targetId==r.targetId){e=i;break}}null!==e&&(this.triggerGroup.splice(e,1),this.triggerGroup=this.triggerGroup)},e.prototype.draw=function(t){this.container=t,this.container.addChild(this)},Object.defineProperty(e.prototype,"isShow",{get:function(){return this._isShow},set:function(t){console.log("isShow = "+t),this._isShow=t,this.currentState=t?"show":"hidden",this.data.targetState=t?1:2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"delayed",{get:function(){return this._delayed},set:function(t){this._delayed=t,this.input_time.text=t.toString(),this.data.delay=t},enumerable:!0,configurable:!0}),e.prototype.onAddToStageInit=function(t){var e=this;this.btn_show.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.isShow=!0},this),this.btn_hidden.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.isShow=!1},this),this.input_time.addEventListener(egret.FocusEvent.FOCUS_OUT,function(t){e.delayed=Number(t.target.text)},this),this.label_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.siderbarSkin.removeEventSet(e.data)},this)},e.prototype.pushData=function(){this.triggerGroup.push(this.data)},e}(eui.Component);__reflect(EventSetDome.prototype,"EventSetDome",["IUUContainer"]);var Game=function(t){function e(){var e=t.call(this)||this;return e.borderColor=13421772,e.editGroup=new EditGroup,e.header=new Header,e.imgBox=new ImageBox,e.bgBox=new BgBox,e.soundBox=new SoundBox,e.comBox=new ComponentBox,e.siderbarSkinBy=SiderbarSkinBy.getInstance(),e.skinName="resource/skins/GameSkin.exml",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStageInit,e),e}return __extends(e,t),e.prototype.onAddToStageInit=function(t){this.initEui()},e.prototype.initEui=function(){var t=new eui.Group;t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t);var e=new egret.Shape;e.graphics.beginFill(16777215,1),e.graphics.drawRect(0,0,750,1334),e.graphics.endFill(),t.addChild(e),this.editGroup.width=750,this.editGroup.height=1334,this.editGroup.horizontalCenter=0,this.editGroup.y=0,this.editGroup.scrollEnabled=!0,t.addChild(this.editGroup),this.header.x=0,this.header.y=0,this.header.width=1920,this.header.height=100,this.drawBg(this.header),this.header.draw(this),this.siderbarSkinBy.x=1420,this.siderbarSkinBy.y=this.header.height+10,this.siderbarSkinBy.draw(this),console.log(this.siderbarSkinBy.data);var i=new eui.HorizontalLayout;i.gap=30,i.horizontalAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE,i.paddingRight=30;var n=new eui.Group;n.width=750,n.height=100,n.horizontalCenter=0,n.layout=i,n.bottom=0,this.addChild(n);var r=new eui.Button;r.width=100,r.height=40,r.label="上一页",r.x=0,r.addEventListener(Mouse.START,this.editGroup.pre,this.editGroup),n.addChild(r);var o=new eui.Button;o.y=50,o.width=100,o.height=40,o.label="下一页",o.addEventListener(Mouse.START,this.editGroup.next,this.editGroup),n.addChild(o)},e.prototype.openComponentPanel=function(){this.comBox.open(this)},e.prototype.openSoundePanel=function(){this.soundBox.open(this)},e.prototype.openImagePanel=function(){this.imgBox.open(this)},e.prototype.openBgPanel=function(){this.bgBox.open(this)},e.prototype.closeImagePanel=function(){this.imgBox.close()},e.prototype.drawBg=function(t,e){void 0===e&&(e=1);var i=new egret.Shape;i.graphics.lineStyle(2,this.borderColor),i.graphics.beginFill(16777215,e),i.graphics.drawRect(0,0,t.width,t.height),i.graphics.endFill(),t.addChild(i)},e}(eui.Component);__reflect(Game.prototype,"Game");var Header=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.dispose=function(){},e.prototype.draw=function(t){this.container=t,this.container.addChild(this)},e.prototype.onAddToStage=function(t){this.init()},e.prototype.init=function(){var t=new eui.HorizontalLayout;t.gap=30,t.horizontalAlign=egret.HorizontalAlign.RIGHT,t.verticalAlign=egret.VerticalAlign.MIDDLE,t.paddingRight=30,this.layout=t;var e=new eui.Button;e.width=100,e.height=40,e.label="组件",e.addEventListener(Mouse.START,this.openComponentPanel,this),this.addChild(e);var i=new eui.Button;i.width=100,i.height=40,i.label="声音",i.addEventListener(Mouse.START,this.openSoundPanel,this),this.addChild(i);var n=new eui.Button;n.width=100,n.height=40,n.label="图片",n.addEventListener(Mouse.START,this.openImagePanel,this),this.addChild(n);var r=new eui.Button;r.width=100,r.height=40,r.label="背景",r.addEventListener(Mouse.START,this.openBgPanel,this),this.addChild(r);var o=new eui.Button;o.width=100,o.height=40,o.label="预览",o.addEventListener(Mouse.START,this.preview,this),this.addChild(o);var s=new eui.Button;s.width=100,s.height=40,s.label="发布",this.addChild(s);var a=new eui.Button;a.width=100,a.height=40,a.label="保存",a.addEventListener(Mouse.START,this.save,this),this.addChild(a)},e.prototype.save=function(t){var e=this.parent;console.log(e.editGroup.pages);var i={code:200,msg:"success",list:e.editGroup.pages},n="id=1&template="+JSON.stringify(i),r=new egret.HttpRequest;r.responseType=egret.HttpResponseType.TEXT,r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.open("http://localhost:8002/template/updateTemplate",egret.HttpMethod.POST),r.send(n),r.addEventListener(egret.Event.COMPLETE,this.onPostComplete,this),r.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this),r.addEventListener(egret.ProgressEvent.PROGRESS,this.onPostProgress,this)},e.prototype.onPostComplete=function(t){var e=t.currentTarget;egret.log("post data : ",e.response)},e.prototype.onPostIOError=function(t){egret.log("post error : "+t)},e.prototype.onPostProgress=function(t){egret.log("post progress : "+Math.floor(100*t.bytesLoaded/t.bytesTotal)+"%")},e.prototype.preview=function(t){var e=this.parent,i=new PreviewBox;i.draw(e)},e.prototype.openComponentPanel=function(t){var e=this.parent;e.openComponentPanel()},e.prototype.openSoundPanel=function(t){var e=this.parent;e.openSoundePanel()},e.prototype.openImagePanel=function(t){var e=this.parent;e.openImagePanel()},e.prototype.openBgPanel=function(t){var e=this.parent;e.openBgPanel()},e}(eui.Group);__reflect(Header.prototype,"Header",["IUUContainer"]);var ImageBox=function(t){function e(){var e=t.call(this)||this;return e.imgList=[{id:"9001",name:"fatcap_png",url:"fatcap.png"},{id:"9002",name:"piggy_png",url:"piggy.png"}],e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.getInstance=function(t){return this.instance||(this.instance=new e),this.instance},e.prototype.onAddToStage=function(t){this.init()},e.prototype.init=function(){this.horizontalCenter=0,this.verticalCenter=0,this.width=1200,this.height=800;for(var t=0;t<this.imgList.length;t++){var e=new UUImage;e.source="resource/assets/"+this.imgList[t].url,e.y=50,e.x=120*t,e.width=100,e.height=100,e.name=this.imgList[t].id,e.data=this.imgList[t],e.addEventListener(Mouse.START,this.addImage,this),this.addChild(e)}},e.prototype.addImage=function(t){var e=this.parent;e.editGroup.addSinglePicture(t.currentTarget.data)},e.prototype.open=function(t){t.addChild(this)},e}(eui.Panel);__reflect(ImageBox.prototype,"ImageBox");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?n(r):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=400,this.textField.x=720,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center",this.textField.textColor=10066329,this.progressBar=new egret.Shape,this.progressBar.height=30,this.progressBar.width=480,this.progressBar.x=720,this.progressBar.y=350,this.progressBar.graphics.beginFill(13421772,1),this.progressBar.graphics.drawRoundRect(0,0,480,30,30),this.progressBar.graphics.endFill(),this.addChild(this.progressBar)},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e,this.progressBar.graphics.beginFill(4174069,1),this.progressBar.graphics.drawRoundRect(0,0,480*t/e,30,30),this.progressBar.graphics.endFill()},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=i.sent(),this.startAnimation(t),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return e=i.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){var t=new Game;this.addChild(t)},e.prototype.startAnimation=function(t){var e=this,i=new egret.HtmlTextParser,n=t.map(function(t){return i.parse(t)}),r=this.textfield,o=-1,s=function(){o++,o>=n.length&&(o=0);var t=n[o];r.textFlow=t;var i=egret.Tween.get(r);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(s,e)};s()},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var PreviewBox=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dispose=function(){},e.prototype.draw=function(t){this.container=t,this.container.addChild(this),this.width=1920,this.height=1080;var e=new egret.Shape;e.graphics.beginFill(13421772,1),e.graphics.drawRect(0,0,1920,1080),e.graphics.endFill(),this.addChild(e),this.addChild(new Preview);var i=new eui.Button;i.y=0,i.right=0,i.width=100,i.height=40,i.label="关闭",i.addEventListener(Mouse.START,this.close,this),this.addChild(i)},e.prototype.close=function(t){this.parent.removeChild(this)},e}(eui.Group);__reflect(PreviewBox.prototype,"PreviewBox",["IUUContainer"]);var SiderbarSkinBy=function(t){function e(){var e=t.call(this)||this;return e.color_AEEEEE=11464430,e.color_000000=0,e._selectionVisible=!1,e.relevanceItemIdList=[],e._relevanceItemIdObj={},e.defaultRelevanceItem={delay:100,eventType:1,sourceId:8405,sourceType:"e",targetId:8405,targetState:1,targetType:"e"},e.data={width:30,height:30,x:30,y:30,rotate:10},e.isFirstSelect=!0,e.skinName="resource/skins/SiderbarSkin.exml",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStageInit,e),e}return __extends(e,t),e.prototype.dispose=function(){},e.prototype.draw=function(t){this.container=t,this.container.addChild(this)},Object.defineProperty(e.prototype,"selectionVisible",{get:function(){return this._selectionVisible},set:function(t){this._selectionVisible=t,this.gp_selection_box.visible=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetItemId",{get:function(){return this._targetItemId},set:function(t){this._targetItemId=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triggerGroup",{get:function(){return this._triggerGroup},set:function(t){var e=this;console.log("set triggerGroup..."),console.log(t),this._triggerGroup=t;var i=t.filter(function(t){return t.sourceId==e.targetItemId});this.relevanceItemIdList=i.map(function(t){return t.targetId});for(var n={},r=0,o=i.length;o>r;r++){var s=i[r];n[s.targetId]=s}this.relevanceItemIdObj=n,this.initShowEventSetList()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relevanceItemIdObj",{get:function(){return this._relevanceItemIdObj},set:function(t){this._relevanceItemIdObj=t,console.log("setter relevanceItemIdObj..."),console.log(t)},enumerable:!0,configurable:!0}),e.getInstance=function(){return null==e._instance&&(e._instance=new e),e._instance},Object.defineProperty(e.prototype,"tabIndex",{get:function(){return this._tabIndex},set:function(t){this._tabIndex=t,this.changeTabIndex(t),this.gp_container_addEvent.visible=!1},enumerable:!0,configurable:!0}),e.prototype.onAddToStageInit=function(t){this.init()},e.prototype.init=function(){mouse.enable(this.stage),mouse.setMouseMoveEnabled(!0);var t=new eui.VerticalLayout;this.gp_eventSetContainer.layout=t,this.listenEvent(),this.tabIndex=2},e.prototype.listenEvent=function(){this.gp_tabs.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchTabsClick,this),this.btn_add_event.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchAddEvent,this),this.gp_add_click_event.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addClickEventItem,this),this.gp_selection_rect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchSelection2,this);for(var t=0,e=this.gp_inputContainer.numChildren;e>t;t++){var i=this.gp_inputContainer.getChildAt(t),n=i.getChildAt(1);n.addEventListener(egret.FocusEvent.FOCUS_OUT,this.onFocusOut,this)}},e.prototype.touchTabsClick=function(t){for(var e=new egret.Point(t.stageX-this.x-0,t.stageY-this.y-60),i=0,n=this.gp_tabs.numChildren;n>i;i++){var r=this.gp_tabs.getChildAt(i),o=new egret.Rectangle(r.x,r.y,r.width,r.height);if(o.containsPoint(e)){console.log(r),console.log(i),this.tabIndex=i;break}}},e.prototype.touchAddEvent=function(t){this.gp_container_addEvent.visible=!0,this.gp_container_addEvent.anchorOffsetX=-this.width,egret.Tween.get(this.gp_container_addEvent).to({anchorOffsetX:0},300)},e.prototype.addClickEventItem=function(t){var e=this;this.gp_eventContainer_event_click.visible=!0,egret.Tween.get(this.gp_container_addEvent).to({anchorOffsetX:-this.width},300).call(function(){e.gp_container_addEvent.visible=!1})},e.prototype.touchSelection2=function(){var t=this;if(this.targetItemId&&(this.selectionVisible=!this.selectionVisible,this.selectionVisible)){this.gp_selection.removeChildren();for(var e=this.parent,i=e.editGroup.displayList,n=function(e,n){var o=i[e].image.data,s=o.id,a=new CheckItem(s);a.y=30*e,a.addEventListener(egret.Event.ADDED_TO_STAGE,function(){var e=-1==t.relevanceItemIdList.indexOf(s)?!1:!0;a.isSelected=e},r),r.gp_selection.addChild(a)},r=this,o=0,s=i.length;s>o;o++)n(o,s);if(!this.isFirstSelect)return;this.isFirstSelect=!1,this.gp_selection.addEventListener(mouse.MouseEvent.MOUSE_OVER,this.onMouseover_Selection,this),this.gp_selection.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick_Selection,this)}},e.prototype.onMouseover_Selection=function(t){for(var e=0,i=this.gp_selection.numChildren;i>e;e++){var n=this.gp_selection.getChildAt(e);n.isOver=!1}t.target.parent.isOver=!0},e.prototype.onClick_Selection=function(t){var e=t.target,i=t.target.parent,n=e.selected,r=i.labelText,o=this.relevanceItemIdObj[r];o||(this.relevanceItemIdObj[r]=JSON.parse(JSON.stringify(this.defaultRelevanceItem)),this.relevanceItemIdObj[r].sourceId=this.targetItemId,this.relevanceItemIdObj[r].targetId=r,this.relevanceItemIdObj=this.relevanceItemIdObj,o=this.relevanceItemIdObj[r]),n?(this.pushEventSet(o),this.relevanceItemIdList.push(r)):this.removeEventSet(o)},e.prototype.drawEventSet=function(t){var e=new EventSetDome;return e.name=t.targetId,e.data=t,e.isShow=1==t.targetState?!0:!1,e.draw(this.gp_eventSetContainer),this.setupEventSetContainer(),e},e.prototype.pushEventSet=function(t){var e=this.drawEventSet(t);e.pushData()},e.prototype.removeEventSet=function(t){var e=t.targetId;console.log("relevanceItemId = "+e);var i=this.gp_eventSetContainer.getChildByName(e);this.gp_eventSetContainer.removeChild(i),i.dispose(),this.relevanceItemIdList.splice(this.relevanceItemIdList.indexOf(e),1),this.setupEventSetContainer()},e.prototype.setupEventSetContainer=function(){var t=this,e=this.scroller_eventSet.height;
setTimeout(function(){t.scroller_eventSet.verticalScrollBar.autoVisibility=!1,t.scroller_eventSet.verticalScrollBar.visible=t.gp_eventSetContainer.height>e},0)},e.prototype.initShowEventSetList=function(){this.gp_eventSetContainer.removeChildren();for(var t=this.parent,e=t.editGroup.displayList,i=0,n=e.length;n>i;i++){var r=e[i].image.data.id,o=-1==this.relevanceItemIdList.indexOf(r)?!1:!0;if(o){var s=this.relevanceItemIdObj[r];this.drawEventSet(s)}}},e.prototype.onFocusOut=function(t){console.log(t.target.id);var e=t.target.parent,i=e.name,n=i.split("_")[1];this.data[n]=Number(t.target.text);var r=this.parent,o=r.editGroup.tool,s=o.target;o.target.owner.image;"input_width"==i&&o.scale(this.data.width/Math.round(s.width*o.endMatrix.a)),("input_x"==i||"input_y"==i)&&o.translate(this.data.x-o.regX,this.data.y-o.regY),"input_rotate"==i&&o.rotate(this.data.rotate*Math.PI/180-o.endMatrix.getRotationX()),this.container.editGroup.render()},e.prototype.activetedTab=function(t){var e=t.getChildByName("label"),i=t.getChildByName("rect_default"),n=t.getChildByName("rect_activeted");i.visible=!1,n.visible=!0,e.textColor=this.color_AEEEEE},e.prototype.unActivetedTab=function(t){var e=t.getChildByName("label"),i=t.getChildByName("rect_default"),n=t.getChildByName("rect_activeted");i.visible=!0,n.visible=!1,e.textColor=this.color_000000},e.prototype.cleanTab=function(){for(var t=0,e=this.gp_tabs.numChildren;e>t;t++){var i=this.gp_tabs.getChildAt(t);this.unActivetedTab(i)}},e.prototype.cleanContainer=function(){for(var t=0,e=this.gp_eventContainers.numChildren;e>t;t++){var i=this.gp_eventContainers.getChildAt(t);i.visible=!1}},e.prototype.changeTabIndex=function(t){var e=this.gp_tabs.getChildAt(t),i=this.gp_eventContainers.getChildAt(t);this.cleanTab(),this.activetedTab(e),this.cleanContainer(),i.visible=!0},e._instance=null,e}(eui.Component);__reflect(SiderbarSkinBy.prototype,"SiderbarSkinBy",["IUUContainer"]);var SoundBox=function(t){function e(){var e=t.call(this)||this;return e.imgList=[{id:"19001",name:"test2_mp3",url:"test2.mp3"}],e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.getInstance=function(t){return this.instance||(this.instance=new ImageBox),this.instance},e.prototype.onAddToStage=function(t){this.init()},e.prototype.init=function(){this.horizontalCenter=0,this.verticalCenter=0,this.width=1200,this.height=800;for(var t=0;t<this.imgList.length;t++){var e=new SoundButton;e.y=50,e.x=120*t,e.label=this.imgList[t].name,e.name=this.imgList[t].id,e.data=this.imgList[t],e.addEventListener(Mouse.START,this.addSound,this),this.addChild(e)}},e.prototype.addSound=function(t){var e=this.parent;e.editGroup.addSound(t.currentTarget.data)},e.prototype.open=function(t){t.addChild(this)},e}(eui.Panel);__reflect(SoundBox.prototype,"SoundBox");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function r(t){e.call(n,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}var s=this;"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(n,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(n,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var TriggerPanel=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){},e}(eui.Group);__reflect(TriggerPanel.prototype,"TriggerPanel");var UUMovieClip=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){},e}(egret.MovieClip);__reflect(UUMovieClip.prototype,"UUMovieClip");